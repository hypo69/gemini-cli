# Обзор архитектуры Gemini CLI

Этот документ предоставляет высокоуровневый обзор архитектуры Gemini CLI.

## Основные компоненты

Gemini CLI в основном состоит из двух основных пакетов, а также набора инструментов, которые могут использоваться системой в процессе обработки ввода из командной строки:

1.  **Пакет CLI (`packages/cli`):**
    - **Назначение:** Содержит пользовательскую часть Gemini CLI, такую как обработка первоначального ввода пользователя, представление окончательного вывода и управление общим пользовательским опытом.
    - **Ключевые функции, содержащиеся в пакете:**
      - [Обработка ввода](./cli/commands.md)
      - Управление историей
      - Рендеринг отображения
      - [Настройка темы и пользовательского интерфейса](./cli/themes.md)
      - [Настройки конфигурации CLI](./cli/configuration.md)

2.  **Основной пакет (`packages/core`):**
    - **Назначение:** Действует как бэкенд для Gemini CLI. Он получает запросы, отправленные из `packages/cli`, организует взаимодействие с Gemini API и управляет выполнением доступных инструментов.
    - **Ключевые функции, содержащиеся в пакете:**
      - Клиент API для связи с Google Gemini API
      - Построение и управление запросами
      - Регистрация и логика выполнения инструментов
      - Управление состоянием для разговоров или сессий
      - Конфигурация на стороне сервера

3.  **Инструменты (`packages/core/src/tools/`):**
    - **Назначение:** Это отдельные модули, которые расширяют возможности модели Gemini, позволяя ей взаимодействовать с локальной средой (например, файловой системой, командами оболочки, веб-запросами).
    - **Взаимодействие:** `packages/core` вызывает эти инструменты на основе запросов от модели Gemini.

## Поток взаимодействия

Типичное взаимодействие с Gemini CLI происходит следующим образом:

1.  **Ввод пользователя:** Пользователь вводит запрос или команду в терминал, который управляется `packages/cli`.
2.  **Запрос к ядру:** `packages/cli` отправляет ввод пользователя в `packages/core`.
3.  **Обработка запроса:** Основной пакет:
    - Создает соответствующий запрос для Gemini API, возможно, включая историю разговоров и определения доступных инструментов.
    - Отправляет запрос в Gemini API.
4.  **Ответ Gemini API:** Gemini API обрабатывает запрос и возвращает ответ. Этот ответ может быть прямым ответом или запросом на использование одного из доступных инструментов.
5.  **Выполнение инструмента (если применимо):**
    - Когда Gemini API запрашивает инструмент, основной пакет готовится к его выполнению.
    - Если запрошенный инструмент может изменять файловую систему или выполнять команды оболочки, пользователю сначала предоставляются подробные сведения об инструменте и его аргументах, и пользователь должен одобрить выполнение.
    - Операции только для чтения, такие как чтение файлов, могут не требовать явного подтверждения пользователя для продолжения.
    - После подтверждения или если подтверждение не требуется, основной пакет выполняет соответствующее действие в рамках соответствующего инструмента, и результат отправляется обратно в Gemini API основным пакетом.
    - Gemini API обрабатывает результат инструмента и генерирует окончательный ответ.
6.  **Ответ CLI:** Основной пакет отправляет окончательный ответ обратно в пакет CLI.
7.  **Отображение пользователю:** Пакет CLI форматирует и отображает ответ пользователю в терминале.

## Ключевые принципы проектирования

- **Модульность:** Разделение CLI (интерфейса) и Core (бэкенда) позволяет осуществлять независимую разработку и потенциальные будущие расширения (например, различные интерфейсы для одного и того же бэкенда).
- **Расширяемость:** Система инструментов разработана таким образом, чтобы быть расширяемой, позволяя добавлять новые возможности.
- **Пользовательский опыт:** CLI ориентирован на предоставление богатого и интерактивного опыта работы с терминалом.
