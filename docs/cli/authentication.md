# Настройка аутентификации

Gemini CLI требует аутентификации в службах Google AI. При первом запуске вам потребуется настроить **один** из следующих методов аутентификации:

1.  **Вход через Google (Gemini Code Assist):**
    - Используйте эту опцию для входа с вашей учетной записью Google.
    - Во время первого запуска Gemini CLI направит вас на веб-страницу для аутентификации. После аутентификации ваши учетные данные будут кэшированы локально, чтобы веб-вход можно было пропустить при последующих запусках.
    - Обратите внимание, что веб-вход должен быть выполнен в браузере, который может взаимодействовать с машиной, на которой запущен Gemini CLI. (В частности, браузер будет перенаправлен на локальный URL-адрес, который будет прослушивать Gemini CLI).
    - <a id="workspace-gca">Пользователям, возможно, придется указать GOOGLE_CLOUD_PROJECT, если:</a>
      1. У вас есть учетная запись Google Workspace. Google Workspace — это платная услуга для предприятий и организаций, которая предоставляет набор инструментов для повышения производительности, включая собственный домен электронной почты (например, your-name@your-company.com), расширенные функции безопасности и административные элементы управления. Эти учетные записи часто управляются работодателем или школой.
      1. Вы получили лицензию Gemini Code Assist через [Программу Google для разработчиков](https://developers.google.com/program/plans-and-pricing) (включая квалифицированных экспертов Google Developer Experts)
      1. Вам была назначена лицензия на текущую стандартную или корпоративную подписку Gemini Code Assist.
      1. Вы используете продукт за пределами [поддерживаемых регионов](https://developers.google.com/gemini-code-assist/resources/available-locations) для бесплатного индивидуального использования.
      1. Вы являетесь владельцем учетной записи Google в возрасте до 18 лет
      - Если вы относитесь к одной из этих категорий, вы должны сначала настроить идентификатор проекта Google Cloud для использования, [включить Gemini for Cloud API](https://cloud.google.com/gemini/docs/discover/set-up-gemini#enable-api) и [настроить разрешения доступа](https://cloud.google.com/gemini/docs/discover/set-up-gemini#grant-iam).

      Вы можете временно установить переменную среды в текущем сеансе оболочки с помощью следующей команды:

      ```bash
      export GOOGLE_CLOUD_PROJECT="ВАШ_ИДЕНТИФИКАТОР_ПРОЕКТА"
      ```
      - Для повторного использования вы можете добавить переменную среды в свой файл [.env](#persisting-environment-variables-with-env-files) или в файл конфигурации вашей оболочки (например, `~/.bashrc`, `~/.zshrc` или `~/.profile`). Например, следующая команда добавляет переменную среды в файл `~/.bashrc`:

      ```bash
      echo 'export GOOGLE_CLOUD_PROJECT="ВАШ_ИДЕНТИФИКАТОР_ПРОЕКТА"' >> ~/.bashrc
      source ~/.bashrc
      ```

2.  **<a id="gemini-api-key"></a>Ключ Gemini API:**
    - Получите свой ключ API в Google AI Studio: [https://aistudio.google.com/app/apikey](https://aistudio.google.com/app/apikey)
    - Установите переменную среды `GEMINI_API_KEY`. В следующих методах замените `ВАШ_КЛЮЧ_GEMINI_API` на ключ API, полученный вами в Google AI Studio:
      - Вы можете временно установить переменную среды в текущем сеансе оболочки с помощью следующей команды:
        ```bash
        export GEMINI_API_KEY="ВАШ_КЛЮЧ_GEMINI_API"
        ```
      - Для повторного использования вы можете добавить переменную среды в свой файл [.env](#persisting-environment-variables-with-env-files).

      - Альтернативно вы можете экспортировать ключ API из файла конфигурации вашей оболочки (например, `~/.bashrc`, `~/.zshrc` или `~/.profile`). Например, следующая команда добавляет переменную среды в файл `~/.bashrc`:

        ```bash
        echo 'export GEMINI_API_KEY="ВАШ_КЛЮЧ_GEMINI_API"' >> ~/.bashrc
        source ~/.bashrc
        ```

        :warning: Имейте в виду, что при экспорте вашего ключа API в файл конфигурации вашей оболочки любой другой процесс, запущенный из оболочки, может его прочитать.

3.  **Vertex AI:**
    - Получите свой ключ Google Cloud API: [Получить ключ API](https://cloud.google.com/vertex-ai/generative-ai/docs/start/api-keys?usertype=newuser)
      - Установите переменную среды `GOOGLE_API_KEY`. В следующих методах замените `ВАШ_КЛЮЧ_GOOGLE_API` на ваш ключ Vertex AI API:
        - Вы можете временно установить эти переменные среды в текущем сеансе оболочки с помощью следующих команд:
          ```bash
          export GOOGLE_API_KEY="ВАШ_КЛЮЧ_GOOGLE_API"
          ```
        - Для повторного использования вы можете добавить переменные среды в свой файл [.env](#persisting-environment-variables-with-env-files) или в файл конфигурации вашей оболочки (например, `~/.bashrc`, `~/.zshrc` или `~/.profile`). Например, следующие команды добавляют переменные среды в файл `~/.bashrc`:
          ```bash
          echo 'export GOOGLE_API_KEY="ВАШ_КЛЮЧ_GOOGLE_API"' >> ~/.bashrc
          source ~/.bashrc
          ```
    - Чтобы использовать учетные данные приложения по умолчанию (ADC), используйте следующую команду:
      - Убедитесь, что у вас есть проект Google Cloud и вы включили Vertex AI API.
        ```bash
        gcloud auth application-default login
        ```
        Дополнительную информацию см. в разделе [Настройка учетных данных приложения по умолчанию для Google Cloud](https://cloud.google.com/docs/authentication/provide-credentials-adc).
      - Установите переменные среды `GOOGLE_CLOUD_PROJECT` и `GOOGLE_CLOUD_LOCATION`. В следующих методах замените `ВАШ_ИДЕНТИФИКАТОР_ПРОЕКТА` и `ВАШ_РАСПОЛОЖЕНИЕ_ПРОЕКТА` на соответствующие значения для вашего проекта:
        - Вы можете временно установить эти переменные среды в текущем сеансе оболочки с помощью следующих команд:
          ```bash
          export GOOGLE_CLOUD_PROJECT="ВАШ_ИДЕНТИФИКАТОР_ПРОЕКТА"
          export GOOGLE_CLOUD_LOCATION="ВАШ_РАСПОЛОЖЕНИЕ_ПРОЕКТА" # например, us-central1
          ```
        - Для повторного использования вы можете добавить переменные среды в свой файл [.env](#persisting-environment-variables-with-env-files)

        - Альтернативно вы можете экспортировать переменные среды из файла конфигурации вашей оболочки (например, `~/.bashrc`, `~/.zshrc` или `~/.profile`). Например, следующие команды добавляют переменные среды в файл `~/.bashrc`:

          ```bash
          echo 'export GOOGLE_CLOUD_PROJECT="ВАШ_ИДЕНТИФИКАТОР_ПРОЕКТА"' >> ~/.bashrc
          echo 'export GOOGLE_CLOUD_LOCATION="ВАШ_РАСПОЛОЖЕНИЕ_ПРОЕКТА"' >> ~/.bashrc
          source ~/.bashrc
          ```

          :warning: Имейте в виду, что при экспорте вашего ключа API в файл конфигурации вашей оболочки любой другой процесс, запущенный из оболочки, может его прочитать.

4.  **Cloud Shell:**
    - Эта опция доступна только при запуске в среде Google Cloud Shell.
    - Она автоматически использует учетные данные вошедшего в систему пользователя в среде Cloud Shell.
    - Это метод аутентификации по умолчанию при запуске в Cloud Shell, если не настроен другой метод.

          :warning: Имейте в виду, что при экспорте вашего ключа API в файл конфигурации вашей оболочки любой другой процесс, запущенный из оболочки, может его прочитать.

### Сохранение переменных среды с помощью файлов `.env`

Вы можете создать файл **`.gemini/.env`** в каталоге вашего проекта или в вашем домашнем каталоге. Создание обычного файла **`.env`** также работает, но `.gemini/.env` рекомендуется для изоляции переменных Gemini от других инструментов.

Gemini CLI автоматически загружает переменные среды из **первого** файла `.env`, который он находит, используя следующий порядок поиска:

1. Начиная с **текущего каталога** и двигаясь вверх к `/`, для каждого каталога он проверяет:
   1. `.gemini/.env`
   2. `.env`
2. Если файл не найден, он возвращается к вашему **домашнему каталогу**:
   - `~/.gemini/.env`
   - `~/.env`

> **Важно:** Поиск останавливается на **первом** найденном файле — переменные **не объединяются** из нескольких файлов.

#### Примеры

**Переопределения для конкретного проекта** (имеют приоритет, когда вы находитесь внутри проекта):

```bash
mkdir -p .gemini
echo 'GOOGLE_CLOUD_PROJECT="ваш-идентификатор-проекта"' >> .gemini/.env
```

**Настройки для всего пользователя** (доступны в каждом каталоге):

```bash
mkdir -p ~/.gemini
cat >> ~/.gemini/.env <<'EOF'
GOOGLE_CLOUD_PROJECT="ваш-идентификатор-проекта"
GEMINI_API_KEY="ваш-ключ-gemini-api"
EOF
```

## Неинтерактивный режим / Безголовые среды

При запуске Gemini CLI в неинтерактивной среде вы не можете использовать интерактивный поток входа.
Вместо этого вы должны настроить аутентификацию с помощью переменных среды.

CLI автоматически определит, работает ли он в неинтерактивном терминале, и будет использовать один из
следующих методов аутентификации, если доступен:

1.  **Ключ Gemini API:**
    - Установите переменную среды `GEMINI_API_KEY`.
    - CLI будет использовать этот ключ для аутентификации в Gemini API.

2.  **Vertex AI:**
    - Установите переменную среды `GOOGLE_GENAI_USE_VERTEXAI=true`.
    - **Использование ключа API:** Установите переменную среды `GOOGLE_API_KEY`.
    - **Использование учетных данных приложения по умолчанию (ADC):**
      - Запустите `gcloud auth application-default login` в вашей среде для настройки ADC.
      - Убедитесь, что установлены переменные среды `GOOGLE_CLOUD_PROJECT` и `GOOGLE_CLOUD_LOCATION`.

Если ни одна из этих переменных среды не установлена в неинтерактивном сеансе, CLI завершит работу с ошибкой.
