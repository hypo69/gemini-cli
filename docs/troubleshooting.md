# Руководство по устранению неполадок

Это руководство содержит решения распространенных проблем и советы по отладке.

## Аутентификация

- **Ошибка: `Failed to login. Message: Request contains an invalid argument`**
  - Пользователи с учетными записями Google Workspace или пользователи с учетными записями Google Cloud,
    связанными с их учетными записями Gmail, могут не иметь возможности активировать бесплатный
    уровень плана Google Code Assist.
  - Для учетных записей Google Cloud вы можете обойти это, установив
    `GOOGLE_CLOUD_PROJECT` на идентификатор вашего проекта.
  - Вы также можете получить ключ API из [AI Studio](https://aistudio.google.com/app/apikey), который также включает
    отдельный бесплатный уровень.

## Часто задаваемые вопросы (FAQ)

- **В: Как обновить Gemini CLI до последней версии?**
  - О: Если установлено глобально через npm, обновите Gemini CLI с помощью команды `npm install -g @google/gemini-cli@latest`. Если запускается из исходного кода, получите последние изменения из репозитория и перестройте с помощью `npm run build`.

- **В: Где хранятся файлы конфигурации Gemini CLI?**
  - О: Конфигурация CLI хранится в двух файлах `settings.json`: один в вашем домашнем каталоге и один в корневом каталоге вашего проекта. В обоих местах `settings.json` находится в папке `.gemini/`. Дополнительные сведения см. в разделе [Конфигурация CLI](./cli/configuration.md).

- **В: Почему я не вижу количество кэшированных токенов в выводе статистики?**
  - О: Информация о кэшированных токенах отображается только при использовании кэшированных токенов. Эта функция доступна для пользователей ключей API (ключ Gemini API или Vertex AI), но в настоящее время недоступна для пользователей OAuth (личные/корпоративные учетные записи Google), так как API Code Assist не поддерживает создание кэшированного контента. Вы по-прежнему можете просмотреть общее использование токенов с помощью команды `/stats`.

## Распространенные сообщения об ошибках и их решения

- **Ошибка: `EADDRINUSE` (Адрес уже используется) при запуске сервера MCP.**
  - **Причина:** Другой процесс уже использует порт, к которому пытается привязаться сервер MCP.
  - **Решение:**
    Либо остановите другой процесс, использующий порт, либо настройте сервер MCP на использование другого порта.

- **Ошибка: Команда не найдена (при попытке запустить Gemini CLI).**
  - **Причина:** Gemini CLI установлен неправильно или отсутствует в PATH вашей системы.
  - **Решение:**
    1.  Убедитесь, что установка Gemini CLI прошла успешно.
    2.  Если установлено глобально, проверьте, что каталог глобальных бинарных файлов npm находится в вашем PATH.
    3.  Если запускается из исходного кода, убедитесь, что вы используете правильную команду для его вызова (например, `node packages/cli/dist/index.js ...`).

- **Ошибка: `MODULE_NOT_FOUND` или ошибки импорта.**
  - **Причина:** Зависимости установлены неправильно или проект не был собран.
  - **Решение:**
    1.  Запустите `npm install`, чтобы убедиться, что все зависимости присутствуют.
    2.  Запустите `npm run build`, чтобы скомпилировать проект.

- **Ошибка: "Операция не разрешена", "Доступ запрещен" или аналогичные.**
  - **Причина:** Если включена песочница, то приложение, вероятно, пытается выполнить операцию, ограниченную вашей песочницей, например, запись за пределами каталога проекта или системного временного каталога.
  - **Решение:** Дополнительную информацию, включая настройку конфигурации песочницы, см. в разделе [Песочница](./cli/configuration.md#sandboxing).

- **CLI не интерактивен в средах "CI"**
  - **Проблема:** CLI не переходит в интерактивный режим (не появляется приглашение), если установлена переменная среды, начинающаяся с `CI_` (например, `CI_TOKEN`). Это связано с тем, что пакет `is-in-ci`, используемый базовым фреймворком пользовательского интерфейса, обнаруживает эти переменные и предполагает неинтерактивную среду CI.
  - **Причина:** Пакет `is-in-ci` проверяет наличие `CI`, `CONTINUOUS_INTEGRATION` или любой переменной среды с префиксом `CI_`. При обнаружении любой из них он сигнализирует, что среда неинтерактивна, что препятствует запуску CLI в интерактивном режиме.
  - **Решение:** Если переменная с префиксом `CI_` не нужна для работы CLI, вы можете временно отменить ее для команды. Например, `env -u CI_TOKEN gemini`

## Советы по отладке

- **Отладка CLI:**
  - Используйте флаг `--verbose` (если доступен) с командами CLI для более подробного вывода.
  - Проверьте журналы CLI, часто находящиеся в каталоге пользовательской конфигурации или кэша.

- **Отладка ядра:**
  - Проверьте вывод консоли сервера на наличие сообщений об ошибках или трассировок стека.
  - Увеличьте детализацию журнала, если это возможно.
  - Используйте инструменты отладки Node.js (например, `node --inspect`), если вам нужно пошагово отладить код на стороне сервера.

- **Проблемы с инструментами:**
  - Если конкретный инструмент не работает, попробуйте изолировать проблему, запустив максимально простую версию команды или операции, которую выполняет инструмент.
  - Для `run_shell_command` сначала проверьте, работает ли команда непосредственно в вашей оболочке.
  - Для инструментов файловой системы дважды проверьте пути и разрешения.

- **Предварительные проверки:**
  - Всегда запускайте `npm run preflight` перед фиксацией кода. Это может выявить многие распространенные проблемы, связанные с форматированием, линтингом и ошибками типов.

Если вы столкнулись с проблемой, не описанной здесь, рассмотрите возможность поиска в трекере проблем проекта на GitHub или сообщите о новой проблеме с подробной информацией.
