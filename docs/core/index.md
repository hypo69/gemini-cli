# Ядро Gemini CLI

Основной пакет Gemini CLI (`packages/core`) является серверной частью Gemini CLI, обрабатывающей связь с Gemini API, управляющей инструментами и обрабатывающей запросы, отправленные из `packages/cli`. Общий обзор Gemini CLI см. на [главной странице документации](../index.md).

## Навигация по этому разделу

- **[API основных инструментов](./tools-api.md):** Информация о том, как инструменты определяются, регистрируются и используются ядром.
- **[Процессор импорта памяти](./memport.md):** Документация по модульной функции импорта GEMINI.md с использованием синтаксиса @file.md.

## Роль ядра

В то время как часть `packages/cli` Gemini CLI предоставляет пользовательский интерфейс, `packages/core` отвечает за:

- **Взаимодействие с Gemini API:** Безопасное взаимодействие с Google Gemini API, отправка пользовательских запросов и получение ответов модели.
- **Проектирование запросов:** Создание эффективных запросов для модели Gemini, возможно, включающих историю разговоров, определения инструментов и контекст инструкций из файлов `GEMINI.md`.
- **Управление и оркестровка инструментов:**
  - Регистрация доступных инструментов (например, инструментов файловой системы, выполнения команд оболочки).
  - Интерпретация запросов на использование инструментов от модели Gemini.
  - Выполнение запрошенных инструментов с предоставленными аргументами.
  - Возврат результатов выполнения инструментов модели Gemini для дальнейшей обработки.
- **Управление сеансами и состоянием:** Отслеживание состояния разговора, включая историю и любой соответствующий контекст, необходимый для связных взаимодействий.
- **Конфигурация:** Управление конфигурациями, специфичными для ядра, такими как доступ к ключу API, выбор модели и настройки инструментов.

## Соображения безопасности

Ядро играет жизненно важную роль в безопасности:

- **Управление ключами API:** Оно обрабатывает `GEMINI_API_KEY` и обеспечивает его безопасное использование при взаимодействии с Gemini API.
- **Выполнение инструментов:** Когда инструменты взаимодействуют с локальной системой (например, `run_shell_command`), ядро (и его базовые реализации инструментов) должны делать это с соответствующей осторожностью, часто с использованием механизмов песочницы для предотвращения непреднамеренных изменений.

## Сжатие истории чата

Чтобы гарантировать, что длинные разговоры не превышают пределы токенов модели Gemini, ядро включает функцию сжатия истории чата.

Когда разговор приближается к пределу токенов для настроенной модели, ядро автоматически сжимает историю разговора перед отправкой ее модели. Это сжатие предназначено для сохранения информации без потерь, но оно уменьшает общее количество используемых токенов.

Вы можете найти пределы токенов для каждой модели в [документации Google AI](https://ai.google.dev/gemini-api/docs/models).

## Откат модели

Gemini CLI включает механизм отката модели, чтобы гарантировать, что вы можете продолжать использовать CLI, даже если модель "pro" по умолчанию имеет ограничение скорости.

Если вы используете модель "pro" по умолчанию и CLI обнаруживает, что у вас есть ограничение скорости, он автоматически переключается на модель "flash" для текущего сеанса. Это позволяет вам продолжать работать без перерыва.

## Служба обнаружения файлов

Служба обнаружения файлов отвечает за поиск файлов в проекте, которые относятся к текущему контексту. Она используется командой `@` и другими инструментами, которым нужен доступ к файлам.

## Служба обнаружения памяти

Служба обнаружения памяти отвечает за поиск и загрузку файлов `GEMINI.md`, которые предоставляют контекст модели. Она ищет эти файлы иерархически, начиная с текущего рабочего каталога и перемещаясь вверх к корню проекта и домашнему каталогу пользователя. Она также ищет в подкаталогах.

Это позволяет вам иметь глобальные, проектные и компонентные файлы контекста, которые все объединяются, чтобы предоставить модели наиболее релевантную информацию.

Вы можете использовать команду [`/memory`](../cli/commands.md) для `показа`, `добавления` и `обновления` содержимого загруженных файлов `GEMINI.md`.
