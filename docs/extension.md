# Расширения Gemini CLI

Gemini CLI поддерживает расширения, которые могут быть использованы для настройки и расширения его функциональности.

## Как это работает

При запуске Gemini CLI ищет расширения в двух местах:

1.  `<workspace>/.gemini/extensions`
2.  `<home>/.gemini/extensions`

Gemini CLI загружает все расширения из обоих мест. Если расширение с тем же именем существует в обоих местах, расширение в каталоге рабочей области имеет приоритет.

В каждом месте отдельные расширения существуют как каталог, который содержит файл `gemini-extension.json`. Например:

`<workspace>/.gemini/extensions/my-extension/gemini-extension.json`

### `gemini-extension.json`

Файл `gemini-extension.json` содержит конфигурацию для расширения. Файл имеет следующую структуру:

```json
{
  "name": "my-extension",
  "version": "1.0.0",
  "mcpServers": {
    "my-server": {
      "command": "node my-server.js"
    }
  },
  "contextFileName": "GEMINI.md",
  "excludeTools": ["run_shell_command"]
}
```

- `name`: Имя расширения. Используется для уникальной идентификации расширения и для разрешения конфликтов, когда команды расширения имеют то же имя, что и пользовательские или проектные команды.
- `version`: Версия расширения.
- `mcpServers`: Карта серверов MCP для настройки. Ключ — это имя сервера, а значение — конфигурация сервера. Эти серверы будут загружены при запуске так же, как серверы MCP, настроенные в файле [`settings.json`](./cli/configuration.md). Если и расширение, и файл `settings.json` настраивают сервер MCP с тем же именем, сервер, определенный в файле `settings.json`, имеет приоритет.
- `contextFileName`: Имя файла, который содержит контекст для расширения. Он будет использоваться для загрузки контекста из рабочей области. Если это свойство не используется, но файл `GEMINI.md` присутствует в каталоге вашего расширения, то этот файл будет загружен.
- `excludeTools`: Массив имен инструментов, которые нужно исключить из модели. Вы также можете указать ограничения для конкретных команд для инструментов, которые это поддерживают, например, для инструмента `run_shell_command`. Например, `"excludeTools": ["run_shell_command(rm -rf)"]` заблокирует команду `rm -rf`.

Когда Gemini CLI запускается, он загружает все расширения и объединяет их конфигурации. Если есть какие-либо конфликты, конфигурация рабочей области имеет приоритет.

## Команды расширений

Расширения могут предоставлять [пользовательские команды](./cli/commands.md#custom-commands), размещая файлы TOML в подкаталоге `commands/` внутри каталога расширения. Эти команды следуют тому же формату, что и пользовательские и проектные пользовательские команды, и используют стандартные соглашения об именовании.

### Пример

Расширение с именем `gcp` со следующей структурой:

```
.gemini/extensions/gcp/
├── gemini-extension.json
└── commands/
    ├── deploy.toml
    └── gcs/
        └── sync.toml
```

Предоставит следующие команды:

- `/deploy` - Отображается как `[gcp] Пользовательская команда из deploy.toml` в справке
- `/gcs:sync` - Отображается как `[gcp] Пользовательская команда из sync.toml` в справке

### Разрешение конфликтов

Команды расширений имеют самый низкий приоритет. При возникновении конфликта с пользовательскими или проектными командами:

1. **Нет конфликта**: Команда расширения использует свое естественное имя (например, `/deploy`)
2. **С конфликтом**: Команда расширения переименовывается с префиксом расширения (например, `/gcp.deploy`)

Например, если и пользователь, и расширение `gcp` определяют команду `deploy`:

- `/deploy` - Выполняет команду развертывания пользователя
- `/gcp.deploy` - Выполняет команду развертывания расширения (помечена тегом `[gcp]`)
