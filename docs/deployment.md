# Выполнение и развертывание Gemini CLI

Этот документ описывает, как запустить Gemini CLI, и объясняет архитектуру развертывания, которую использует Gemini CLI.

## Запуск Gemini CLI

Существует несколько способов запуска Gemini CLI. Выбор зависит от того, как вы собираетесь использовать Gemini CLI.

---

### 1. Стандартная установка (рекомендуется для обычных пользователей)

Это рекомендуемый способ установки Gemini CLI для конечных пользователей. Он включает загрузку пакета Gemini CLI из реестра NPM.

- **Глобальная установка:**

  ```bash
  npm install -g @google/gemini-cli
  ```

  Затем запустите CLI из любого места:

  ```bash
  gemini
  ```

- **Выполнение NPX:**

  ```bash
  # Выполнить последнюю версию из NPM без глобальной установки
  npx @google/gemini-cli
  ```

---

### 2. Запуск в песочнице (Docker/Podman)

Для безопасности и изоляции Gemini CLI может быть запущен внутри контейнера. Это стандартный способ выполнения инструментов CLI, которые могут иметь побочные эффекты.

- **Непосредственно из реестра:**
  Вы можете запустить опубликованный образ песочницы напрямую. Это полезно для сред, где у вас есть только Docker и вы хотите запустить CLI.
  ```bash
  # Запустить опубликованный образ песочницы
  docker run --rm -it us-docker.pkg.dev/gemini-code-dev/gemini-cli/sandbox:0.1.1
  ```
- **Использование флага `--sandbox`:**
  Если у вас установлен Gemini CLI локально (с использованием стандартной установки, описанной выше), вы можете указать ему запускаться внутри контейнера песочницы.
  ```bash
  gemini --sandbox -y -p "ваш запрос здесь"
  ```

---

### 3. Запуск из исходного кода (рекомендуется для участников Gemini CLI)

Участники проекта захотят запускать CLI непосредственно из исходного кода.

- **Режим разработки:**
  Этот метод обеспечивает горячую перезагрузку и полезен для активной разработки.
  ```bash
  # Из корня репозитория
  npm run start
  ```
- **Режим, похожий на производственный (связанный пакет):**
  Этот метод имитирует глобальную установку путем связывания вашего локального пакета. Он полезен для тестирования локальной сборки в производственном рабочем процессе.

  ```bash
  # Связать локальный пакет cli с вашими глобальными node_modules
  npm link packages/cli

  # Теперь вы можете запустить свою локальную версию с помощью команды `gemini`
  gemini
  ```

---

### 4. Запуск последней версии Gemini CLI из GitHub

Вы можете запустить самую последнюю закоммиченную версию Gemini CLI непосредственно из репозитория GitHub. Это полезно для тестирования функций, находящихся в разработке.

```bash
# Выполнить CLI непосредственно из основной ветки на GitHub
  npx https://github.com/google-gemini/gemini-cli
```

## Архитектура развертывания

Описанные выше методы выполнения стали возможными благодаря следующим архитектурным компонентам и процессам:

**Пакеты NPM**

Проект Gemini CLI представляет собой монорепозиторий, который публикует два основных пакета в реестр NPM:

- `@google/gemini-cli-core`: Бэкенд, обрабатывающий логику и выполнение инструментов.
- `@google/gemini-cli`: Пользовательский интерфейс.

Эти пакеты используются при выполнении стандартной установки и при запуске Gemini CLI из исходного кода.

**Процессы сборки и упаковки**

Используются два различных процесса сборки, в зависимости от канала распространения:

- **Публикация NPM:** Для публикации в реестре NPM исходный код TypeScript в `@google/gemini-cli-core` и `@google/gemini-cli` транспилируется в стандартный JavaScript с использованием компилятора TypeScript (`tsc`). Полученный каталог `dist/` публикуется в пакете NPM. Это стандартный подход для библиотек TypeScript.

- **Выполнение `npx` из GitHub:** При запуске последней версии Gemini CLI непосредственно из GitHub запускается другой процесс с помощью скрипта `prepare` в `package.json`. Этот скрипт использует `esbuild` для объединения всего приложения и его зависимостей в один автономный файл JavaScript. Этот пакет создается на лету на машине пользователя и не проверяется в репозитории.

**Образ песочницы Docker**

Метод выполнения на основе Docker поддерживается образом контейнера `gemini-cli-sandbox`. Этот образ публикуется в реестре контейнеров и содержит предварительно установленную глобальную версию Gemini CLI.

## Процесс выпуска

Процесс выпуска автоматизирован с помощью GitHub Actions. Рабочий процесс выпуска выполняет следующие действия:

1.  Сборка пакетов NPM с использованием `tsc`.
2.  Публикация пакетов NPM в реестре артефактов.
3.  Создание выпусков GitHub с bundled assets.
