# Контрольные точки

Gemini CLI включает функцию контрольных точек, которая автоматически сохраняет снимок состояния вашего проекта перед любыми изменениями файлов, сделанными инструментами на базе ИИ. Это позволяет безопасно экспериментировать и применять изменения кода, зная, что вы можете мгновенно вернуться к состоянию до запуска инструмента.

## Как это работает

Когда вы одобряете инструмент, который изменяет файловую систему (например, `write_file` или `replace`), CLI автоматически создает "контрольную точку". Эта контрольная точка включает:

1.  **Снимок Git:** Коммит делается в специальном теневом репозитории Git, расположенном в вашем домашнем каталоге (`~/.gemini/history/<project_hash>`). Этот снимок фиксирует полное состояние файлов вашего проекта в этот момент. Он **не** вмешивается в собственный репозиторий Git вашего проекта.
2.  **История разговоров:** Вся беседа, которую вы вели с агентом до этого момента, сохраняется.
3.  **Вызов инструмента:** Также сохраняется конкретный вызов инструмента, который должен был быть выполнен.

Если вы хотите отменить изменение или просто вернуться назад, вы можете использовать команду `/restore`. Восстановление контрольной точки:

- Вернет все файлы в вашем проекте к состоянию, зафиксированному в снимке.
- Восстановит историю разговоров в CLI.
- Повторно предложит исходный вызов инструмента, позволяя вам запустить его снова, изменить его или просто проигнорировать.

Все данные контрольных точек, включая снимок Git и историю разговоров, хранятся локально на вашей машине. Снимок Git хранится в теневом репозитории, а история разговоров и вызовы инструментов сохраняются в файле JSON во временном каталоге вашего проекта, обычно расположенном по адресу `~/.gemini/tmp/<project_hash>/checkpoints`.

## Включение функции

Функция контрольных точек по умолчанию отключена. Чтобы включить ее, вы можете использовать флаг командной строки или отредактировать файл `settings.json`.

### Использование флага командной строки

Вы можете включить контрольные точки для текущего сеанса, используя флаг `--checkpointing` при запуске Gemini CLI:

```bash
gemini --checkpointing
```

### Использование файла `settings.json`

Чтобы включить контрольные точки по умолчанию для всех сеансов, вам необходимо отредактировать файл `settings.json`.

Добавьте следующий ключ в ваш `settings.json`:

```json
{
  "checkpointing": {
    "enabled": true
  }
}
```

## Использование команды `/restore`

После включения контрольные точки создаются автоматически. Для управления ими используется команда `/restore`.

### Список доступных контрольных точек

Чтобы просмотреть список всех сохраненных контрольных точек для текущего проекта, просто выполните:

```
/restore
```

CLI отобразит список доступных файлов контрольных точек. Эти имена файлов обычно состоят из метки времени, имени изменяемого файла и имени инструмента, который должен был быть запущен (например, `2025-06-22T10-00-00_000Z-my-file.txt-write_file`).

### Восстановление конкретной контрольной точки

Чтобы восстановить ваш проект до определенной контрольной точки, используйте файл контрольной точки из списка:

```
/restore <checkpoint_file>
```

Например:

```
/restore 2025-06-22T10-00-00_000Z-my-file.txt-write_file
```

После выполнения команды ваши файлы и разговор будут немедленно восстановлены до состояния, в котором они находились при создании контрольной точки, и появится исходный запрос инструмента.
